uiTransmit:
	CALL	_ENT_PARM_DIRECT_L09
	BIT	1,(IX+8)
	JR	Z,_0001
_0000:
	LD	E,2
	CALL	vSetCPU
	LD	L,(IX+10)
	LD	H,(IX+11)
	PUSH	HL
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	uiXModemCRC16
	POP	AF
	LD	(IX+10),L
	LD	(IX+11),H
_0001:
	LD	E,0
	CALL	vSetCPU
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	vJIOTransmit
	XOR	A
	OR	(IX+12)
	JR	Z,_0003
	BIT	1,(IX+8)
	JR	Z,_0003
_0005:
_0004:
_0002:
	LD	BC,2
	LD	HL,10
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOTransmit
_0003:
	LD	L,(IX+10)
	LD	H,(IX+11)
	JP	_LEAVE_DIRECT_L09
ucReceive:
	CALL	_ENT_PARM_DIRECT_L09
	LD	A,2
	XOR	C
	OR	B
	JR	Z,_0007
_0006:
	LD	E,0
	CALL	vSetCPU
_0007:
_0009:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0008
_0010:
	BIT	2,(IX+8)
	JR	NZ,_0007
_0011:
	LD	A,4
	JR	_0013
_0012:
_0008:
	XOR	A
_0013:
	JP	_LEAVE_DIRECT_L09
ucReadOrWriteSectors:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	65510
	PUSH	IY
	LD	HL,W_FLAGS
	LD	C,(IX+12)
	LD	B,(IX+13)
	ADD	HL,BC
	LD	D,(HL)
	LD	IYH,D
	LD	HL,W_COMMAND
	ADD	HL,BC
	LD	B,(HL)
	LD	(IX-4),B
	CALL	eGetCPU
	LD	(IX-7),A
	LD	(IX-18),74
	LD	(IX-17),73
	LD	(IX-16),79
	LD	(IX-15),D
	LD	B,(IX+2)
	LD	(IX-13),B
	LD	H,(IX+3)
	LD	(IX-12),H
	LD	L,(IX+4)
	LD	BC,0
	LD	(IX-11),L
	LD	B,(IX+8)
	LD	(IX-10),B
	LD	L,(IX+10)
	LD	H,(IX+11)
	LD	(IX-9),L
	LD	(IX-8),H
	LD	H,B
	LD	L,C
	ADD	HL,HL
	LD	(IX-26),L
	LD	(IX-25),H
_0016:
	LD	B,(IX-4)
	LD	(IX-14),B
	LD	A,B
	CP	7
	JR	NZ,_0043
	LD	A,1
	JR	_0044
_0043:
	XOR	A
_0044:
	LD	C,A
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	IYL,0
	LD	A,(IX-4)
	CP	6
	JR	NZ,_0018
_0017:
	LD	C,0
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,6
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	B,IYH
	BIT	1,B
	JR	Z,_0023
_0019:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,27
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0023
_0021:
	LD	C,(IX-3)
	LD	B,(IX-2)
	LD	HL,4369
	AND	A
	SBC	HL,BC
	JR	NZ,_0025
_0024:
	LD	IYL,2
	JR	_0037
_0025:
	LD	HL,8738
	AND	A
	SBC	HL,BC
	JR	Z,_0037
_0026:
	LD	IYL,3
_0023:
_0022:
_0020:
	JR	_0037
_0018:
	CP	5
	JR	NZ,_0029
_0028:
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,6
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0029:
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0037
	LD	B,IYH
	BIT	0,B
	JR	Z,_0037
_0033:
_0032:
_0030:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,6
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0037
_0034:
	LD	E,2
	CALL	vSetCPU
	LD	HL,0
	PUSH	HL
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiXModemCRC16
	POP	AF
	LD	C,(IX-24)
	LD	B,(IX-23)
	AND	A
	SBC	HL,BC
	JR	Z,_0037
_0036:
	LD	IYL,1
_0037:
_0035:
_0031:
_0027:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0039
_0038:
	LD	(IX-14),B
	LD	C,1
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0039:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0014
	LD	B,IYH
	BIT	3,B
	JP	NZ,_0016
_0014:
	LD	E,(IX-7)
	CALL	vSetCPU
	LD	A,IYL
	POP	IY
	JP	_LEAVE_DIRECT_L09
