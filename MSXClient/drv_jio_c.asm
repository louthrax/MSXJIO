uiTransmit:
	CALL	_ENT_PARM_DIRECT_L09
	BIT	1,(IX+8)
	JR	Z,_0001
_0000:
	BIT	4,(IX+8)
	JR	NZ,_0003
_0002:
	LD	E,2
	CALL	vSetCPU
	DEFB	251
_0003:
	LD	L,(IX+10)
	LD	H,(IX+11)
	PUSH	HL
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	uiXModemCRC16
	POP	AF
	LD	(IX+10),L
	LD	(IX+11),H
_0001:
	BIT	4,(IX+8)
	JR	NZ,_0005
_0004:
	LD	E,0
	CALL	vSetCPU
_0005:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	vJIOTransmit
	XOR	A
	OR	(IX+12)
	JR	Z,_0007
	BIT	1,(IX+8)
	JR	Z,_0007
_0009:
_0008:
_0006:
	LD	BC,2
	LD	HL,10
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOTransmit
_0007:
	LD	L,(IX+10)
	LD	H,(IX+11)
	JP	_LEAVE_DIRECT_L09
ucReceive:
	CALL	_ENT_PARM_DIRECT_L09
	LD	A,2
	XOR	C
	OR	B
	JR	Z,_0013
_0010:
	BIT	4,(IX+8)
	JR	NZ,_0013
_0012:
	LD	E,0
	CALL	vSetCPU
_0013:
_0011:
_0015:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0014
_0016:
	BIT	2,(IX+8)
	JR	Z,_0013
_0017:
	LD	A,3
	JR	_0019
_0018:
_0014:
	XOR	A
_0019:
	JP	_LEAVE_DIRECT_L09
ucReadOrWriteSectors:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	65510
	PUSH	IY
	LD	HL,W_FLAGS
	LD	C,(IX+12)
	LD	B,(IX+13)
	ADD	HL,BC
	LD	D,(HL)
	LD	IYH,D
	LD	HL,W_COMMAND
	ADD	HL,BC
	LD	B,(HL)
	LD	(IX-3),B
	BIT	4,D
	JR	NZ,_0021
_0020:
	CALL	eGetCPU
	LD	(IX-6),A
_0021:
	LD	(IX-18),74
	LD	(IX-17),73
	LD	(IX-16),79
	LD	B,IYH
	LD	(IX-15),B
	LD	HL,36
	ADD	HL,SP
	INC	HL
	LD	B,(HL)
	DEC	HL
	LD	(HL),B
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	L,(IX+2)
	LD	H,(IX+3)
	LD	(IX-13),L
	LD	(IX-12),H
	LD	(IX-11),C
	LD	(IX-10),B
	LD	B,(IX+8)
	LD	(IX-9),B
	LD	L,(IX+10)
	LD	H,(IX+11)
	LD	(IX-8),L
	LD	(IX-7),H
	LD	L,B
	LD	H,L
	LD	L,0
	ADD	HL,HL
	LD	(IX-26),L
	LD	(IX-25),H
_0024:
	LD	B,(IX-3)
	LD	(IX-14),B
	LD	A,B
	CP	18
	JR	NZ,_0054
	LD	A,1
	JR	_0055
_0054:
	XOR	A
_0055:
	LD	C,A
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	A,(IX-3)
	CP	17
	JR	NZ,_0026
_0025:
	LD	C,0
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,28
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0030
_0027:
	LD	HL,4369
	LD	C,(IX-2)
	LD	B,(IX-1)
	AND	A
	SBC	HL,BC
	JR	Z,_0030
_0029:
	LD	HL,13107
	AND	A
	SBC	HL,BC
	JR	NZ,_0032
	LD	A,1
	JR	_0033
_0032:
	LD	A,11
_0033:
	LD	IYL,A
_0030:
_0028:
	JR	_0046
_0026:
	CP	16
	JR	NZ,_0036
_0035:
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0036:
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0046
	LD	B,IYH
	BIT	0,B
	JR	Z,_0046
_0040:
_0039:
_0037:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,6
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0046
_0041:
	LD	B,IYH
	BIT	4,B
	JR	NZ,_0044
_0043:
	LD	E,2
	CALL	vSetCPU
	DEFB	251
_0044:
	LD	HL,0
	PUSH	HL
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiXModemCRC16
	POP	AF
	LD	C,(IX-24)
	LD	B,(IX-23)
	AND	A
	SBC	HL,BC
	JR	Z,_0046
_0045:
	LD	IYL,5
_0046:
_0042:
_0038:
_0034:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0048
_0047:
	LD	(IX-14),B
	LD	C,1
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0048:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0022
	LD	B,IYH
	BIT	3,B
	JP	NZ,_0024
_0022:
	LD	B,IYH
	BIT	4,B
	JR	NZ,_0052
_0051:
	LD	E,(IX-6)
	CALL	vSetCPU
_0052:
	LD	A,IYL
	POP	IY
	JP	_LEAVE_DIRECT_L09
