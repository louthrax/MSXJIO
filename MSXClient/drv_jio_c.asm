ucReadOrWriteSectors:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	-16
	PUSH	IY
	CALL	eGetCPU
	LD	(IX-15),A
	LD	(IX-10),74
	LD	(IX-9),73
	LD	(IX-8),79
	LD	B,(IX+2)
	LD	(IX-6),B
	LD	H,(IX+3)
	LD	(IX-5),H
	LD	L,C
	LD	BC,0
	LD	(IX-4),L
	LD	B,(IX+8)
	LD	(IX-3),B
	LD	L,(IX+10)
	LD	H,(IX+11)
	LD	(IX-2),L
	LD	(IX-1),H
	LD	H,B
	LD	L,C
	ADD	HL,HL
	PUSH	HL
	POP	IY
_0002:
	LD	B,(IX+12)
	LD	(IX-7),B
	LD	E,0
	CALL	vSetCPU
	DEFB	243
	LD	BC,10
	LD	HL,8
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOSend
	LD	A,(IX+12)
	AND	15
	DEC	A
	DEC	A
	JR	NZ,_0004
_0003:
	PUSH	IY
	POP	BC
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	vJIOSend
	JR	_0006
_0004:
_0007:
	PUSH	IY
	POP	BC
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0006
_0008:
	BIT	6,(IX+12)
	JR	NZ,_0004
_0009:
	JP	_0030
_0010:
_0006:
_0005:
	BIT	4,(IX+12)
	JR	Z,_0014
	LD	A,(IX+12)
	AND	15
	JR	Z,_0018
_0014:
_0013:
	BIT	5,(IX+12)
	JR	Z,_0012
	LD	A,(IX+12)
	AND	15
	DEC	A
	DEC	A
	JR	NZ,_0012
_0018:
_0017:
_0015:
_0016:
_0011:
_0020:
	LD	BC,2
	LD	HL,4
	ADD	HL,SP
	EX	DE,HL
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0019
_0021:
	BIT	6,(IX+12)
	JR	NZ,_0018
_0022:
	JR	_0030
_0023:
_0019:
	LD	E,2
	CALL	vSetCPU
	PUSH	IY
	POP	BC
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiXModemCRC16
	LD	C,(IX-14)
	LD	B,(IX-13)
	AND	A
	SBC	HL,BC
	JR	NZ,_0034
	LD	A,1
	JR	_0035
_0034:
	XOR	A
_0035:
	LD	(IX-16),A
	OR	A
	JR	NZ,_0026
_0024:
	INC	(IX-7)
	LD	E,A
	CALL	vSetCPU
	DEFB	243
	LD	BC,10
	LD	HL,8
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOSend
_0025:
	JR	_0026
_0012:
	LD	(IX-16),1
_0026:
	XOR	A
	OR	(IX-16)
	JR	NZ,_0000
	BIT	7,(IX+12)
	JP	NZ,_0002
_0000:
	LD	E,(IX-15)
	CALL	vSetCPU
	DEFB	251
	XOR	A
	OR	(IX-16)
	JR	Z,_0030
	XOR	A
	JR	_0031
_0030:
	LD	A,1
_0031:
_0032:
	POP	IY
	JP	_LEAVE_DIRECT_L09
