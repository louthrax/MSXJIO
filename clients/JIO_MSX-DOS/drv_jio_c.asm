uiTransmit:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	65530
	PUSH	IY
	LD	E,C
	LD	D,B
	LD	L,(IX+2)
	LD	H,(IX+3)
	LD	(IX-6),L
	LD	(IX-5),H
	BIT	1,(IX+8)
	JR	Z,_0001
_0000:
	PUSH	DE
	LD	L,(IX+10)
	LD	H,(IX+11)
	PUSH	HL
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	uiXModemCRC16
	POP	AF
	LD	(IX+10),L
	LD	(IX+11),H
	POP	DE
_0001:
_0003:
	LD	A,E
	OR	D
	JR	Z,_0002
_0004:
	LD	HL,40
	SBC	HL,DE
	JR	NC,_0006
	LD	HL,40
	JR	_0007
_0006:
	LD	L,E
	LD	H,D
_0007:
	LD	(IX-4),L
	LD	(IX-3),H
	PUSH	DE
	LD	C,L
	LD	B,H
	LD	E,(IX-6)
	LD	D,(IX-5)
	CALL	vJIOTransmit
	POP	DE
	LD	L,(IX-4)
	LD	H,(IX-3)
	AND	A
	EX	DE,HL
	SBC	HL,DE
	EX	DE,HL
	LD	HL,2
	ADD	HL,SP
	LD	A,(HL)
	ADD	A,(IX-4)
	LD	(HL),A
	INC	HL
	LD	A,(HL)
	ADC	A,(IX-3)
	LD	(HL),A
	LD	A,E
	OR	D
	JR	Z,_0001
_0008:
	LD	IY,1024
_0011:
	LD	A,IYL
	OR	IYH
	JR	Z,_0001
_0012:
	DEC	IY
	JR	_0011
_0010:
_0009:
_0002:
	OR	(IX+12)
	JR	Z,_0015
	BIT	1,(IX+8)
	JR	Z,_0015
_0017:
_0016:
_0014:
	LD	BC,2
	LD	HL,18
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOTransmit
_0015:
	LD	L,(IX+10)
	LD	H,(IX+11)
	POP	IY
	JP	_LEAVE_DIRECT_L09
ucReceive:
	CALL	_ENT_PARM_DIRECT_L09
_0070:
_0019:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0018
_0020:
	BIT	2,(IX+8)
	JR	Z,_0070
_0021:
	LD	A,3
	JR	_0023
_0022:
_0018:
	XOR	A
_0023:
	JP	_LEAVE_DIRECT_L09
ucDoCommand:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	65510
	PUSH	IY
	LD	HL,W_FLAGS
	LD	C,(IX+12)
	LD	B,(IX+13)
	ADD	HL,BC
	LD	D,(HL)
	LD	IYH,D
	LD	HL,W_COMMAND
	ADD	HL,BC
	LD	B,(HL)
	LD	(IX-4),B
	LD	(IX-18),74
	LD	(IX-17),73
	LD	(IX-16),79
	LD	(IX-15),D
	LD	HL,36
	ADD	HL,SP
	INC	HL
	LD	B,(HL)
	DEC	HL
	LD	(HL),B
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	L,(IX+2)
	LD	H,(IX+3)
	LD	(IX-13),L
	LD	(IX-12),H
	LD	(IX-11),C
	LD	(IX-10),B
	LD	B,(IX+8)
	LD	(IX-9),B
	LD	L,(IX+10)
	LD	H,(IX+11)
	LD	(IX-8),L
	LD	(IX-7),H
	LD	L,B
	LD	H,L
	LD	L,0
	ADD	HL,HL
	LD	(IX-26),L
	LD	(IX-25),H
_0026:
	LD	B,(IX-4)
	LD	(IX-14),B
	LD	A,B
	CP	18
	JR	Z,_0028
	CP	19
	JR	Z,_0028
	XOR	A
	JR	_0029
_0028:
	LD	A,1
_0029:
	LD	C,A
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	A,(IX-4)
	CP	19
	JR	NZ,_0031
_0030:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,27
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0039
_0032:
	LD	HL,17476
	LD	C,(IX-3)
	LD	B,(IX-2)
	AND	A
	SBC	HL,BC
	JR	NZ,_0035
_0034:
	LD	IYL,20
	JR	_0039
_0035:
	LD	HL,21845
	AND	A
	SBC	HL,BC
	JR	NZ,_0038
_0037:
	LD	IYL,21
	JR	_0039
_0038:
	LD	IYL,5
_0039:
_0036:
_0033:
	JP	_0063
_0031:
	CP	17
	JR	NZ,_0042
_0041:
	LD	C,0
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,27
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0052
_0043:
	LD	HL,8738
	LD	C,(IX-3)
	LD	B,(IX-2)
	AND	A
	SBC	HL,BC
	JR	NZ,_0046
_0045:
	LD	HL,13107
	AND	A
	SBC	HL,BC
	JR	NZ,_0048
	LD	A,1
	JR	_0049
_0048:
	LD	A,11
_0049:
	LD	IYL,A
	JR	_0063
_0046:
	LD	HL,4369
	AND	A
	SBC	HL,BC
	JR	Z,_0063
_0051:
	LD	IYL,5
_0052:
_0050:
_0044:
	JR	_0063
_0042:
	CP	16
	JR	NZ,_0055
_0054:
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0055:
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0063
	LD	B,IYH
	BIT	0,B
	JR	Z,_0063
_0059:
_0058:
_0056:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,6
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0063
_0060:
	LD	L,A
	LD	H,A
	PUSH	HL
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiXModemCRC16
	POP	AF
	LD	C,(IX-24)
	LD	B,(IX-23)
	AND	A
	SBC	HL,BC
	JR	Z,_0063
_0062:
	LD	IYL,5
_0063:
_0061:
_0057:
_0053:
_0040:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0065
	LD	A,IYL
	CP	20
	JR	Z,_0065
	CP	21
	JR	Z,_0065
_0067:
_0066:
_0064:
	LD	(IX-14),B
	LD	C,1
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0065:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0024
	LD	A,IYL
	CP	20
	JR	Z,_0024
	CP	21
	JR	Z,_0024
	LD	B,IYH
	BIT	3,B
	JP	NZ,_0026
_0024:
	LD	A,IYL
	POP	IY
	JP	_LEAVE_DIRECT_L09
